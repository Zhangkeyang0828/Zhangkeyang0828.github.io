<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"/><meta name="theme-color" content="#3b3e43"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="format-detection" content="telephone=no"/><title>总线的判优控制 - 张科扬</title><meta name="description" content="总线判优仲裁"/><meta property="og:description" content="总线判优仲裁"/>    <meta name="keywords" content="Solo,博客,开源"/><link rel="dns-prefetch" href="https://Zhangkeyang0828.github.io"/><link rel="dns-prefetch" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="https://Zhangkeyang0828.github.io"><link rel="icon" type="image/png" href="https://b3log.org/images/brand/solo-128.png"/><link rel="apple-touch-icon" href="https://b3log.org/images/brand/solo-128.png"><link rel="shortcut icon" type="image/x-icon" href="https://b3log.org/images/brand/solo-128.png"><meta name="copyright" content="B3log"/><meta http-equiv="Window-target" content="_top"/><meta property="og:locale" content="zh_CN"/><meta property="og:title" content="总线的判优控制 - 张科扬"/><meta property="og:site_name" content="张科扬"/><meta property="og:url"      content="https://Zhangkeyang0828.github.io/articles/2021/02/13/1613219908489.html?"/><meta property="og:image" content="https://b3log.org/images/brand/solo-128.png"/><link rel="search" type="application/opensearchdescription+xml" title="总线的判优控制 - 张科扬" href="/opensearch.xml"><link href="https://Zhangkeyang0828.github.io/rss.xml" title="RSS" type="application/rss+xml" rel="alternate"/><link rel="manifest" href="https://Zhangkeyang0828.github.io/manifest.json">        <link rel="canonical" href="https://Zhangkeyang0828.github.io/articles/2021/02/13/1613219908489.html">        <link rel="stylesheet"
              href="https://Zhangkeyang0828.github.io/skins/nijigen/css/base.css?1613470431968"/>
            <link rel="prev" title="总线结构及其演进" href="https://Zhangkeyang0828.github.io/articles/2021/02/13/1613219732753.html">
            <link rel="next" title="总线的通讯控制" href="https://Zhangkeyang0828.github.io/articles/2021/02/14/1613314851546.html">
    <script src="https://cdn.jsdelivr.net/npm/vditor@3.6.6/dist/js/icons/ant.js" async="" id="vditorIconScript"></script></head>
<body>
<div class="bg"></div>
<div class="bg bg--1"></div>
<div class="bg bg--2"></div>
<div class="bg bg--3"></div>
<div class="bg bg--4"></div>
<div class="bg bg--5"></div>
<header class="header">
    <div class="header__wrap">
        <a href="https://Zhangkeyang0828.github.io" rel="start" class="header__logo">
            <i class="icon__home"></i> 张科扬
        </a>

        <nav class="mobile__hidden header__nav">
            <a href="https://Zhangkeyang0828.github.io/tags.html" rel="section">
                <i class="icon__tags"></i> 标签墙
            </a>
            <a href="https://Zhangkeyang0828.github.io/archives.html">
                <i class="icon__inbox"></i> 存档
            </a>
            <a rel="archive" href="https://Zhangkeyang0828.github.io/links.html">
                <i class="icon__link"></i> 友链
            </a>
            <a rel="alternate" href="https://Zhangkeyang0828.github.io/rss.xml" rel="section">
                <i class="icon__rss"></i> RSS
            </a>
        </nav>

    </div>
</header>
<div class="header__m fn__none">
    <i class="icon__list fn__none" onclick="$(this).next().slideToggle()"></i>
    <main class="module__list fn__none"></main>
    <i class="icon__more" onclick="$(this).next().slideToggle()"></i>
    <main class="module__list">
        <ul>
            <li>
                <a href="https://Zhangkeyang0828.github.io/tags.html" rel="section">
                    <i class="icon__tags"></i> 标签墙
                </a>
            </li>
            <li>
                <a href="https://Zhangkeyang0828.github.io/archives.html">
                    <i class="icon__inbox"></i> 存档
                </a>
            </li>
            <li>
                <a rel="archive" href="https://Zhangkeyang0828.github.io/links.html">
                    <i class="icon__link"></i> 友链
                </a>
            </li>
            <li>
                <a rel="alternate" href="https://Zhangkeyang0828.github.io/rss.xml" rel="section">
                    <i class="icon__rss"></i> RSS
                </a>
            </li>
        </ul>
    </main>
</div>
<div class="main" id="pjax">
    
    <div class="content">
        <main id="articlePage">
            <div class="article-list">
                <div class="item item--active">
                    <time class="vditor-tooltipped vditor-tooltipped__n item__date"
                          aria-label="2021年">
                        02月
                        <span class="item__day">13</span>
                    </time>

                    <h2 class="item__title">
                        <a rel="bookmark" href="https://Zhangkeyang0828.github.io/articles/2021/02/13/1613219908489.html">
                            总线的判优控制
                        </a>
                    </h2>

                    <div class="item__date--m fn__none">
                        <i class="icon__date"></i>
                        2021-02-13
                    </div>

                    <div class="ft__center">
                        <span class="tag">
                            <i class="icon__tags"></i>
                            <a rel="tag" href="https://Zhangkeyang0828.github.io/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%E5%8E%9F%E7%90%86">
                                计算机系统原理</a>
                        </span>
                            <a class="tag" href="https://Zhangkeyang0828.github.io/articles/2021/02/13/1613219908489.html#b3logsolocomments">
                                <i class="icon__comments"></i> <span data-uvstatcmt="1613219908489">0</span> 评论
                            </a>
                        <span class="tag">
                            <i class="icon__views"></i>
                        <span data-uvstaturl="https://Zhangkeyang0828.github.io/articles/2021/02/13/1613219908489.html">0</span> 浏览
                        </span>
                    </div>

                    <div class="vditor-reset">
                        <p>在同一时刻，很可能有多个设备同时申请使用总线进行数据传输。那么到底要让哪对设备使用总线呢？这个问题被称为<strong>总线判优仲裁</strong>。</p>
<p>既然一对设备要申请使用总线，那么至少要向总线提出占用请求。为了简化硬件设计，设计人员规定：在总线上的一对设备中，<strong>主设备</strong>对总线具有控制权(也就是可以提出总线的占用请求，并且在占用总线后可以发起与另一个设备的交互)；<strong>从设备</strong>本身对总线没有控制权，只能响应从总线发起的交互请求。</p>
<h1 id="toc_h1_0">1. 集中式判优控制</h1>
<p>所谓的<em>集中式判优控制</em>就是将这个用于实现总线判优的逻辑用一整个芯片来实现，并将其直接嵌入到CPU当中，以下介绍几种经典的设计方案。</p>
<h2 id="toc_h2_1">1.1 链式查询方式</h2>
<p><img src="https://b3logfile.com/file/2021/02/总线判优链式查询.drawio-2535c3fb.png?imageView2/2/w/1280/format/jpg/interlace/1/q/100" alt="总线判优链式查询.drawio.png"></p>
<p>链式查询法是最简单的一种实现方式。其中：</p>
<ul>
<li><strong>数据线</strong>：用于在两个设备之间传输数据。</li>
<li><strong>地址线</strong>：用于在两个设备之间发送地址。</li>
<li><strong>BS</strong>：用于在总线上传输<em>总线忙</em>信号。如果某个设备已经占用了总线，就使用这根线告知请求设备。</li>
<li><strong>BR</strong>：用于在总线上传输<em>总线请求</em>信号。想要占用总线的设备通过这根线发出请求。</li>
<li><strong>BG</strong>：用于在总线上传输<em>总线同意</em>信号。控制部件通过这根线告知设备可以占用总线。</li>
</ul>
<p>所谓的链式查询，就是指当总线没有被占用，并且接收到了至少一个设备的占用请求时，<strong>总线控制部件沿着BG这根线开始按设备挂接顺序依次检查每个I/O设备，只要找到了一个发起占用请求的设备，就将总线控制权交给该设备，并标记“总线忙”</strong>。显而易见，链式查询方式本质上是一种顺序查找方式，I/O设备获得总线的优先级完全由其挂接在总线上的位置确定。</p>
<p>这种方式的优点是：</p>
<ul>
<li><strong>实现非常简单</strong>。</li>
<li><strong>增删设备非常容易</strong>。</li>
</ul>
<p>这种方式的缺点是：</p>
<ul>
<li><strong>无法使用软件干预硬件行为</strong>。</li>
<li><strong>对电路故障非常敏感。如果BR线连接的某个端口故障，则BR检查信号无法发送到其后的所有设备</strong>。</li>
<li><strong>如果某个设备挂接在总线靠后的位置，那么它获得总线使用权的机会就非常小，极端情况下可能一直无法获取总线使用权</strong>。</li>
</ul>
<h2 id="toc_h2_2">1.2 计数器定时查询方式</h2>
<p><img src="https://b3logfile.com/file/2021/02/总线判优计数器定时查询0.drawio-3f2d1745.png?imageView2/2/w/1280/format/jpg/interlace/1/q/100" alt="总线判优计数器定时查询0.drawio.png"></p>
<p>计数器定时查询法是对链式查询法的简单改进。其中：</p>
<ul>
<li><strong>数据线</strong>：用于在两个设备之间传输数据。</li>
<li><strong>地址线</strong>：用于在两个设备之间发送地址。</li>
<li><strong>设备地址线</strong>：用于在总线上向所有设备发送<em>计数器</em>的值。</li>
<li><strong>BS</strong>：用于在总线上传输<em>总线忙</em>信号。如果某个设备已经占用了总线，就使用这根线告知请求设备。</li>
<li><strong>BR</strong>：用于在总线上传输<em>总线请求</em>信号。想要占用总线的设备通过这根线发出请求。</li>
</ul>
<p>所谓的计数器定时查询，就是指当总线没有被占用，并且接收到了至少一个设备的占用请求时，<strong>总线控制部件获取计数器中的值，然后在设备地址线中向所有挂接在总线上的设备发送这个值；与这个值所表示的序号相匹配的I/O设备通过BS线应答控制器，如果这个设备申请占用总线，就发送1；如果没有申请占用总线，就发送0。如果总线控制部件通过BS线收到了控制信号0，就将计数器中的值进行累加，然后再次通过设备地址线发送给所有挂接在总线上的设备。不断地重复这个过程，直到控制器通过BS线收到了控制信号1时，控制器将总线控制权交给这个发送控制信号1的设备。</strong></p>
<p>在计数器定时查询法中，由于计数器的值会保存上一次所选中的设备序号，因此总线上设备的优先级是循环优先级。计数器中的初始值可以是事先确定的，也可以通过软件修改计数器中的值来进行优先级的动态调整。</p>
<p>这种方式的优点是：</p>
<ul>
<li><strong>可以通过软件来调整硬件的行为</strong>。</li>
<li><strong>可以改变设备的优先级</strong>。</li>
<li><strong>对电路的故障不如链式查询方式敏感</strong>。</li>
</ul>
<p>这种方式的缺点是：</p>
<ul>
<li><strong>增加了控制线的条数(少了一根BG线，多了[log2N]条设备地址线)</strong>。</li>
<li><strong>控制方式相对复杂，硬件实现比链式查询方式困难</strong>。</li>
</ul>
<h2 id="toc_h2_3">1.3 独立请求方式</h2>
<p><img src="https://b3logfile.com/file/2021/02/总线判优独立请求.drawio-4c13588c.png?imageView2/2/w/1280/format/jpg/interlace/1/q/100" alt="总线判优独立请求.drawio.png"></p>
<p>链式查询法和计数器定时查询法的本质都是按照设备在总线上所处的位置顺序查找的， 所以速度都相对比较慢。独立请求方式是一种牺牲空间效率换取时间效率的实现方式。其中：</p>
<ul>
<li><strong>数据线</strong>：用于在两个设备之间传输数据。</li>
<li><strong>地址线</strong>：用于在两个设备之间发送地址。</li>
<li><strong>BR</strong>：用于在总线上传输<em>总线请求</em>信号。想要占用总线的设备通过这根线发出请求。</li>
<li><strong>BG</strong>：用于在总线上传输<em>总线同意</em>信号。控制部件通过这根线告知设备可以占用总线。</li>
</ul>
<p>所谓的独立请求，就是指当总线没有被占用，并且接收到了至少一个设备的占用请求时，<strong>总线控制部件将所有的占用请求在其内部的排队器硬件中进行排队，并通过预先定义或者软件设定的算法选取一个优先级最高的I/O接口，然后向这个I/O接口发送BG信号，将总线控制权交给这个设备</strong>。</p>
<p>这种方式的优点是：</p>
<ul>
<li><strong>响应时间很快</strong>。</li>
<li><strong>可以通过软件来调整硬件的行为</strong>。</li>
</ul>
<p>这种方式的缺点是：</p>
<ul>
<li><strong>控制线数量非常多。</strong></li>
<li><strong>总线控制部件的硬件设计相当复杂。</strong></li>
</ul>
<h1 id="toc_h1_4">2. 分布式判优控制</h1>
<p>所谓的<em>分布式判优控制</em>就是将这个用于实现总线判优的逻辑分散到总线上各个硬件的端口上实现。这种判优方式不需要一个专门的总线判优部件，总线上的每个设备都有自己的判优硬件，这些判优硬件共同竞争总线。当一部分部件需要使用总线时，他们就把各自的编号同步地发送到一根仲裁总线上；此时所有的判优硬件都可以接受到这个编号，他们将这个编号与自己的编号进行比较；如果总线上的编号优先级高，则这个部件的总线占用请求不予响应；否则，这个部件就将自己的编号发送到仲裁总线上，覆盖之前的编号值。进行一轮竞选后，最终获胜设备的编号将会保留在仲裁总线上，总线的控制权归这个设备所有。</p>
                    </div>
                </div>
            </div>

                <div class="module mobile__hidden">
                    <div class="module__content fn__clear">
                            <a href="https://Zhangkeyang0828.github.io/articles/2021/02/13/1613219732753.html" rel="prev" class="fn__left breadcrumb">
                                旧一篇: 总线结构及其演进
                            </a>
                            <a href="https://Zhangkeyang0828.github.io/articles/2021/02/14/1613314851546.html" rel="next"
                               class="fn__right breadcrumb">
                                总线的通讯控制: 新一篇
                            </a>
                    </div>
                </div>

                <div class="module mobile__hidden fn__none">
                    <div class="module__content">
                        <a href="https://Zhangkeyang0828.github.io/articles/2021/02/13/1613219732753.html" rel="prev" class="breadcrumb">
                            旧一篇: 总线结构及其演进
                        </a>
                    </div>
                </div>

                <div class="module mobile__hidden fn__none">
                    <div class="module__content">
                        <a href="https://Zhangkeyang0828.github.io/articles/2021/02/14/1613314851546.html" rel="next"
                           class="breadcrumb">
                            新一篇: 总线的通讯控制
                        </a>
                    </div>
                </div>
                <div id="gitalk-container" class="module__content"
                     style="border-radius: 5px;margin-bottom: 30px;box-shadow: 1px 1px 3px 1px rgba(0,0,0,0.2);transition: all .3s;"></div>
                <div id="b3logsolocomments"></div>
                <div id="vcomment" class="module__content"
                     style="border-radius: 5px;margin-bottom: 30px;box-shadow: 1px 1px 3px 1px rgba(0,0,0,0.2);transition: all .3s;"
                     data-name="zhangkeyang" data-postId="1613219908489"></div>

            <div class="fn__flex article__relevant">
                <div class="fn__flex-1" id="externalRelevantArticlesWrap">
                    <div class="module">
                        <div id="externalRelevantArticles" class="module__list"></div>
                    </div>
                </div>
                <div class="mobile__hidden">&nbsp; &nbsp; &nbsp; &nbsp;</div>
                <div class="fn__flex-1" id="randomArticlesWrap">
                    <div class="module">
                        <div id="randomArticles" class="module__list"></div>
                    </div>
                </div>
                <div class="mobile__hidden">&nbsp; &nbsp; &nbsp; &nbsp;</div>
                <div class="fn__flex-1" id="relevantArticlesWrap">
                    <div class="module">
                        <div id="relevantArticles" class="module__list"></div>
                    </div>
                </div>
            </div>
        </main>
    </div>
<aside class="side">
        <div class="module">
            <div class="module__list">
<ul class="article__toc">
        <li class="toc__h1">
            <a href="#toc_h1_0">1. 集中式判优控制</a>
        </li>
        <li class="toc__h2">
            <a href="#toc_h2_1">1.1 链式查询方式</a>
        </li>
        <li class="toc__h2">
            <a href="#toc_h2_2">1.2 计数器定时查询方式</a>
        </li>
        <li class="toc__h2">
            <a href="#toc_h2_3">1.3 独立请求方式</a>
        </li>
        <li class="toc__h1">
            <a href="#toc_h1_4">2. 分布式判优控制</a>
        </li>
</ul>            </div>
        </div>
        <section class="vditor-reset module">
            <main class="module__content">
                Open Source, Open Mind, <br/>Open Sight, Open Future!

<!-- 公告栏可使用 HTML、JavaScript，比如可以在此加入第三方统计 js -->
            </main>
        </section>


    <div class="module item">
        <header class="module__header ft__center">
            zhangkeyang
        </header>
        <main class="module__content ft__center">
            <img class="side__avatar" src="https://b3logfile.com/avatar/1605724109427_1613368546738.jpeg?imageView2/1/w/128/h/128/interlace/0/q/100" alt="zhangkeyang"/>
            记录精彩的程序人生 <br> <br>
    <a href="https://ld246.com/member/zhangkeyang"
       title="https://ld246.com/member/zhangkeyang"
       class="user__site"
       target="_blank" rel="noopener nofollow">
        <svg viewBox="0 0 32 32" width="100%" height="100%">
            <path fill="#d23f31" style="fill: var(--color1, #d23f31)" d="M5.787 17.226h17.033l5.954 9.528c0.47 0.752 0.003 1.361-1.042 1.361h-15.141z"></path>
            <path d="M10.74 3.927h17.033c1.045 0 1.512 0.609 1.042 1.361l-5.954 9.528h-19.872l6.379-10.209c0.235-0.376 0.849-0.681 1.372-0.681z"></path>
            <path d="M2.953 17.226h2.839l6.804 10.889h-1.892c-0.523 0-1.137-0.305-1.372-0.681z"></path>
        </svg>
    </a>


        </main>
    </div>


        <div class="module item">
            <header class="module__header">标签</header>
            <main class="module__content--three module__content fn__clear">
                    <a rel="tag"
                       href="https://Zhangkeyang0828.github.io/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%E5%8E%9F%E7%90%86"
                       class="tag vditor-tooltipped vditor-tooltipped__n"
                       aria-label="6 篇文章">
                        计算机系统原理</a>
                    <a rel="tag"
                       href="https://Zhangkeyang0828.github.io/tags/Solo"
                       class="tag vditor-tooltipped vditor-tooltipped__n"
                       aria-label="1 篇文章">
                        Solo</a>
            </main>
        </div>

    <div class="module item">
        <div class="module__header">
            <div class="fn__flex">
                <a href="https://Zhangkeyang0828.github.io/archives.html" class="fn__flex-1 ft__center">
                    7
                    文章
                </a>
            </div>
            <br/>
            <div class="fn__flex">
                <div class="fn__flex-1 ft__center">
                    <span data-uvstaturl="https://Zhangkeyang0828.github.io">0</span> <span class="ft-gray">浏览</span>
                </div>
            </div>
        </div>
    </div>
</aside>
    
</div>
</div>
<div class="icon__up" onclick="Util.goTop()"></div>
<footer class="footer">
    &copy; 2021
    <a href="https://Zhangkeyang0828.github.io">张科扬</a>
    
    <div class="fn__none"></div>
</footer>
<div class="icon-up" onclick="Util.goTop()"></div>

<script>
  var Label = {
    speech: true,
    servePath: "https://Zhangkeyang0828.github.io",
    staticServePath: "https://Zhangkeyang0828.github.io",
    luteAvailable: false,
    hljsStyle: 'github',
    langLabel: "zh_CN",
    version: "4.3.1",
    staticSite: true,
    showCodeBlockLn: false,
    articleId: "1613219908489",
  }
</script>
<script type="text/javascript" src="https://Zhangkeyang0828.github.io/skins/nijigen/js/common.min.js?1613470431968" charset="utf-8"></script>


<script type="text/javascript">
    Util.addScript('https://Zhangkeyang0828.github.io/js/page.min.js?1613470431968', 'soloPageScript')
    var page = new Page({
        "commentContentCannotEmptyLabel": "评论不能为空",
        "oId": "1613219908489",
        "blogHost": "https://Zhangkeyang0828.github.io",
        "randomArticles1Label": "随机阅读：",
        "externalRelevantArticles1Label": "站外相关阅读："
    });
    $(document).ready(function () {
        page.load();
    page.tips.externalRelevantArticlesDisplayCount = "0";
    page.loadRandomArticles('<header class="module__header">随机阅读</header>');
    page.loadRelevantArticles('1613219908489', '<header class="module__header">相关阅读</header>');
    Skin.initArticle()
    });
</script>

</body>
</html>

<!-- Generated by Latke (https://github.com/88250/latke) in 34ms, 2021/02/16 18:15:29 -->